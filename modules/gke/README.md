# GKE module

Module for provision GKE on Google Cloud

## Requirements

| Name      | Version  |
| --------- | -------- |
| terraform | >= 0.12  |
| google    | >= 3.5.0 |

## Providers

| Name   | Version  |
| ------ | -------- |
| google | >= 3.5.0 |

## Inputs

| Name                              | Description                                                                                                                                                                                                                                                                                                                                                                                                  | Type           | Default                                  | Required |
| --------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------- | ---------------------------------------- | :------: |
| autoscaling_enabled               | Whether node auto-provisioning is enabled. Resource limits for cpu and memory must be defined to enable node auto-provisioning                                                                                                                                                                                                                                                                               | `bool`         | `false`                                  |    no    |
| autoscaling_resource_limit_max    | Maximum amount of the resource in the cluster.                                                                                                                                                                                                                                                                                                                                                               | `number`       | `null`                                   |    no    |
| autoscaling_resource_limit_min    | Minimum amount of the resource in the cluster.                                                                                                                                                                                                                                                                                                                                                               | `number`       | `null`                                   |    no    |
| autoscaling_resource_limit_type   | The type of the resource. For example, cpu and memory. See the guide to using Node Auto-Provisioning for a list of types.                                                                                                                                                                                                                                                                                    | `string`       | `"cpu"`                                  |    no    |
| cluster_ipv4_cidr                 | The IP address range of the Kubernetes pods in this cluster in CIDR notation (e.g. 10.96.0.0/14). Leave blank to have one automatically chosen or specify a /14 block in 10.0.0.0/8. This field will only work for routes-based clusters, where ip_allocation_policy is not defined.                                                                                                                         | `string`       | `null`                                   |    no    |
| cluster_name                      | name of GKE cluster to provision                                                                                                                                                                                                                                                                                                                                                                             | `string`       | n/a                                      |   yes    |
| default_max_pods_per_node         | The default maximum number of pods per node in this cluster. This doesn't work on `routes-based` clusters, clusters that don't have IP Aliasing enabled. See the official documentation for more information.                                                                                                                                                                                                | `number`       | `null`                                   |    no    |
| description                       | Description of the cluster.                                                                                                                                                                                                                                                                                                                                                                                  | `string`       | `null`                                   |    no    |
| enable_binary_authorization       | Enable Binary Authorization for this cluster. If enabled, all container images will be validated by Google Binary Authorization.                                                                                                                                                                                                                                                                             | `bool`         | `false`                                  |    no    |
| enable_cloudrun_config            | The status of the CloudRun addon.                                                                                                                                                                                                                                                                                                                                                                            | `bool`         | `false`                                  |    no    |
| enable_horizontal_pod_autoscaling | The status of the Horizontal Pod Autoscaling addon, which increases or decreases the number of replica pods a replication controller has based on the resource usage of the existing pods. It ensures that a Heapster pod is running in the cluster, which is also used by the Cloud Monitoring service.                                                                                                     | `bool`         | `true`                                   |    no    |
| enable_http_load_balancing        | The status of the HTTP (L7) load balancing controller addon, which makes it easy to set up HTTP load balancers for services in a cluster.                                                                                                                                                                                                                                                                    | `bool`         | `true`                                   |    no    |
| enable_kubernetes_alpha           | Whether to enable Kubernetes Alpha features for this cluster. Note that when this option is enabled, the cluster cannot be upgraded and will be automatically deleted after 30 days.                                                                                                                                                                                                                         | `bool`         | `false`                                  |    no    |
| enable_legacy_abac                | Whether the ABAC authorizer is enabled for this cluster. When enabled, identities in the system, including service accounts, nodes, and controllers, will have statically granted permissions beyond those provided by the RBAC configuration or IAM. Defaults to false                                                                                                                                      | `bool`         | `false`                                  |    no    |
| enable_network_policy_config      | Whether we should enable the network policy addon for the master. This must be enabled in order to enable network policy for the nodes. To enable this, you must also define a network_policy block, otherwise nothing will happen. It can only be disabled if the nodes already do not have network policies enabled.                                                                                       | `bool`         | `false`                                  |    no    |
| enable_shielded_nodes             | Enable Shielded Nodes features on all nodes in this cluster.                                                                                                                                                                                                                                                                                                                                                 | `bool`         | `false`                                  |    no    |
| location                          | Cluster master location. Specific a zone the cluster will be a zonal cluster with a single cluster master. If you specify a region the cluster will be a regional cluster with multiple masters spread across zones in the region, and with default node locations in those zones as well                                                                                                                    | `string`       | `null`                                   |    no    |
| logging_service                   | The logging service that the cluster should write logs to. Available options include logging.googleapis.com(Legacy Stackdriver), logging.googleapis.com/kubernetes(Stackdriver Kubernetes Engine Logging), and none. Defaults to logging.googleapis.com/kubernetes                                                                                                                                           | `string`       | `"logging.googleapis.com/kubernetes"`    |    no    |
| machine_type                      | type of machine to run as workers                                                                                                                                                                                                                                                                                                                                                                            | `string`       | `"n1-standard-1"`                        |    no    |
| maintenance_policy                | The maintenance policy to use for the cluster. Structure is documented below.                                                                                                                                                                                                                                                                                                                                | `string`       | `"logging.googleapis.com/kubernetes"`    |    no    |
| min_master_version                | The minimum version of the master. GKE will auto-update the master to new versions, so this does not guarantee the current master version                                                                                                                                                                                                                                                                    | `string`       | `null`                                   |    no    |
| monitoring_service                | The monitoring service that the cluster should write metrics to. Automatically send metrics from pods in the cluster to the Google Cloud Monitoring API. VM metrics will be collected by Google Compute Engine regardless of this setting Available options include monitoring.googleapis.com(Legacy Stackdriver), monitoring.googleapis.com/kubernetes(Stackdriver Kubernetes Engine Monitoring), and none. | `string`       | `"monitoring.googleapis.com/kubernetes"` |    no    |
| node_count                        | number of GKE nodes per zone                                                                                                                                                                                                                                                                                                                                                                                 | `number`       | `1`                                      |    no    |
| node_locations                    | GKE cluster location specific zone willregion will create multi cluster master                                                                                                                                                                                                                                                                                                                               | `list(string)` | `null`                                   |    no    |
| pod_range                         | The IP address range for the cluster pod IPs. Set to blank to have a range chosen with the default size                                                                                                                                                                                                                                                                                                      | `string`       | `null`                                   |    no    |
| preemptible                       | Enable preemptible for compute engine                                                                                                                                                                                                                                                                                                                                                                        | `bool`         | `false`                                  |    no    |
| project_id                        | project id to provision GKE                                                                                                                                                                                                                                                                                                                                                                                  | `string`       | `null`                                   |    no    |
| region                            | region to create VPC                                                                                                                                                                                                                                                                                                                                                                                         | `string`       | `null`                                   |    no    |
| secondary_pod_range               | The name of the existing secondary range in the cluster's subnetwork to use for pod IP addresses. Alternatively, cluster_ipv4_cidr_block can be used to automatically create a GKE-managed one.                                                                                                                                                                                                              | `string`       | `null`                                   |    no    |
| secondary_service_range           | The name of the existing secondary range in the cluster's subnetwork to use for service ClusterIPs. Alternatively, services_ipv4_cidr_block can be used to automatically create a GKE-managed one.                                                                                                                                                                                                           | `string`       | `null`                                   |    no    |
| service_range                     | The IP address range of the services IPs in this cluster. Set to blank to have a range chosen with the default size                                                                                                                                                                                                                                                                                          | `string`       | `null`                                   |    no    |
| subnet_name                       | Subnet name                                                                                                                                                                                                                                                                                                                                                                                                  | `string`       | `null`                                   |    no    |
| vpc_name                          | VPC name                                                                                                                                                                                                                                                                                                                                                                                                     | `string`       | `null`                                   |    no    |

## Outputs

| Name                    | Description      |
| ----------------------- | ---------------- |
| kubernetes_cluster_name | GKE Cluster Name |

## Example

```terraform
provider "google" {
  credentials = jsonencode(var.credentials)

  project = var.project_id
  region  = var.region
  zone    = var.zone
}

module "gke" {
  source = "github.com/opsta/terraform-gcp//modules/gke?ref=master"

  cluster_name = "test-gke"
}
```
